'use strict';class t{constructor(a,d,c){this.name=c;this.h=`${d}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==d)throw Error(`uniform field "${this.h}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==d)throw Error(`in field "${this.h}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function u(a){const d=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&d.push(new t(c[1],c[2],c[3]))});return d}
const v=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function w(a,d,c=0){var b=a.a;b=b[b.length-1]||v;d=new Float32Array([b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],d*b[0]+0*b[4]+c*b[8]+b[12],d*b[1]+0*b[5]+c*b[9]+b[13],d*b[2]+0*b[6]+c*b[10]+b[14],d*b[3]+0*b[7]+c*b[11]+b[15]]);a.b.uniformMatrix4fv(a.c,!1,d);a.a.push(d)}class x{constructor(a,d){this.b=a;this.c=d;this.a=[];a.uniformMatrix4fv(d,!1,v)}pop(){return this.a.pop()}}
class y{constructor(a,d){this.name=a.name;var c=this.b=a.b;a=this.type=a.type;switch(a){case "vertex":var b=this.b.VERTEX_SHADER;break;case "fragment":b=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}b=this.a=c.createShader(b);c.shaderSource(b,d);c.compileShader(b);if(!c.getShaderParameter(b,c.COMPILE_STATUS))throw d=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(b)}`,c.deleteShader(b),Error(d);this.m=u(d)}}
function z(a,...d){const c=a.b,b=a.g;d.forEach(e=>{a.i.push(e);c.attachShader(b,e.a)});return a}
class A{constructor(a){this.name=a.name;this.l=a.l;a=this.b=a.b;this.j=!1;this.g=a.createProgram();this.i=[];this.f={};this.c={};this.stack=null;this.a=[];this.u=()=>{var d=this.b,c=this.g;d.useProgram(c);for(var b={},e={},h=this.i,f=0;f<h.length;f++)for(var l=h[f].m,k=0;k<l.length;k++){var g=l[k];1===g.type?g.h in b||(b[g.name]=d.getUniformLocation(c,g.h)):g.h in e||(e[g.name]=d.getAttribLocation(c,g.h))}this.f=b;this.c=e;if(c=this.l)if(c in this.f)this.stack=new x(d,this.f[c]);else throw Error(`No anchor point "${c}" in program`);
try{var m=this.a;for(f=0;f<m.length;m++)m[f](d,this)}finally{this.f={},this.c={},this.stack=null,1===this.a.length?this.a=[]:this.a.pop()}}}link(){if(this.j)return this;var a=this.b,d=this.g;a.linkProgram(d);if(!a.getProgramParameter(d,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(d)}`;a.deleteProgram(d);throw Error(c);}this.j=!0;return this}}
class G{constructor(a,d,c,b,e){this.b=a;this.name=d;this.w=c;d=this.a=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);e(a);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,null)}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}}
function H(a){return(new Promise((d,c)=>{const b=new Image;b.onload=()=>void d(b);b.onerror=()=>{c(Error(`failed to load ${a.src}`))};b.mode="no-cors";b.src=a.src})).then(d=>{const c=d.naturalWidth,b=d.naturalHeight;return new G(a.b,a.name,c,b,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,b,0,e.RGBA,e.UNSIGNED_BYTE,d)})})}function I(a){const d=a.width,c=a.height;return new G(a.b,a.name,d,c,b=>{b.texImage2D(b.TEXTURE_2D,0,b.RGBA,d,c,0,b.RGBA,b.UNSIGNED_BYTE,a.s,0)})};class J{constructor(){this.j=null;this.f=60;this.a=this.c=0;this.i=()=>{{const d=this.a;var a=Date.now();const c=this.g;0!==c&&(this.c=1E3/(a-c)*.1+.9*this.c);this.g=a;try{const b=this.j;b()}finally{a=1E3/this.f-(Date.now()-a),this.a===d&&(this.a=setTimeout(this.i,Math.max(a,0)))}}};this.g=0}start(a=this.f){this.f=a;this.a||(this.g=0,this.c=a,this.a=setTimeout(this.i,0))}};function K(a,d){const c=a.a.b;let b=a.c;null!=b?c.bindBuffer(c.ARRAY_BUFFER,b):(a.c=b=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,b),c.bufferData(c.ARRAY_BUFFER,a.f,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(d.f.texture,0);c.enableVertexAttribArray(d.c.texturePosition);c.vertexAttribPointer(d.c.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(d.c.position);c.vertexAttribPointer(d.c.position,3,c.FLOAT,!1,20,0)}
function L(a){if(!a.data.hasOwnProperty("main"))throw Error('Can not render unknown "main"');const d=a.data.main;a=a.a.b;a.drawArrays(a.TRIANGLE_STRIP,d.o[0],d.v)}
class M{constructor(a,d){this.a=a;this.c=null;a=this.data={};const c=[];let b=0;for(const e in d){const h=d[e],f=[],l=h.length;if(0===l)throw Error("Sprite declared with 0 points");const k=h[0].length;if(0==k)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const g=k/5;for(let m=0;m<l;m++){const q=h[m];if(q.length!==k)throw Error("Sprite declared with inconsistent lengths of elements");f.push(b);c.push.apply(c,q);b+=g}a[e]={A:this,name:e,o:f,v:g}}this.f=new Float32Array(c)}}
;function N(){const a=new Uint8Array(518400);for(let e=0;360>e;e++)for(let h=0;360>h;h++){const f=4*(360*e+h);var d=h-180,c=e-180;d=d*d+c*c;if(4>=d)a[f]=255,a[f+1]=255,a[f+2]=255,a[f+3]=255;else{var b=4/d;c=Math.floor(256*b);b=Math.floor(256*b*b);a[f]=255;a[f+1]=b;a[f+2]=b;a[f+3]=32400<=d?0:c}}return a}
window.onload=async function(){function a(n,p){n=p.stack;var B=O;n.b.uniformMatrix4fv(n.c,!1,B);n.a.push(B);w(p.stack,0,.5);K(q,p);L(q);K(C,p);L(C);p.stack.pop();K(D,p);w(p.stack,E/360,(h-F)/360);L(D)}const d=document.getElementById("fps"),c=document.getElementById("canvas");var b=window.getComputedStyle(c);let e=parseInt(b.getPropertyValue("width"),10),h=parseInt(b.getPropertyValue("height"),10);b=window.devicePixelRatio||1;1!==b&&(c.width=b*e,c.height=b*h);b=c.getContext("webgl2",{antialias:!1,
alpha:!1});b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var f=new y({b,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out highp vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n\n        gl_Position = position / position.w;\n        v_texturePosition = a_texturePosition;\n    }\n"),l=new y({b,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in highp vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }\n");
const k=new A({b,l:"projection"});z(k,f,l).link();f=5E3/360;l=34/360;var g=175/360,m=175/209;const q=new M(await H({b,src:"assets/Background Wall.png",name:"wall"}),{main:[[1280/360,g/2,0,1,0,1280/360,g/2,328/360,1,1,0,g/2,0,0,0,0,g/2,328/360,0,1]]}),C=new M(await H({b,src:"assets/Floor 2.png",name:"floor"}),{main:[[f,-g/2,-l,1,1,0,-g/2,-l,0,1,f,-g/2,0,1,m,0,-g/2,0,0,m,f,g/2,0,1,0,0,g/2,0,0,0]]});b=I({name:"fade",width:360,height:360,b,s:N()});const D=new M(b,{main:[[.5,0,-.5,1,0,.5,0,.5,1,1,-.5,
0,-.5,0,0,-.5,0,.5,0,1]],white:[[40,0,0,.5,.5,40,0,20,.5,.5,0,0,0,.5,.5,0,0,20,.5,.5]]});let E=0,F=0;const O=new Float32Array([720/e,0,0,0,0,720/h,0,0,0,720/h,0,0,-1,-1,0,1]),r=new J;r.j=function(){d.innerHTML=`fps=${Math.round(r.c)}/${r.f}`;k.a.includes(a)||k.a.push(a);requestAnimationFrame(k.u)};r.start(60);c.onmousemove=n=>{E=n.offsetX;F=n.offsetY}};
