'use strict';class u{constructor(a,d){switch(d){case "uniform":this.name=(d=/^u_(.+)/.exec(a))?d[1]:a;this.j=a;this.type=1;break;case "attribute":this.name=(d=/^a_(.+)/.exec(a))?d[1]:a,this.j=a,this.type=2}}}function v(a){const d=[];a.split("\n").forEach(b=>{(b=/^\s*(uniform|attribute)\s+\w*\s*(\w*);/.exec(b))&&d.push(new u(b[2],b[1]))});return d}const w=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
function x(a,d,b=0){var c=a.a;c=c[c.length-1]||w;d=new Float32Array([c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],d*c[0]+0*c[4]+b*c[8]+c[12],d*c[1]+0*c[5]+b*c[9]+c[13],d*c[2]+0*c[6]+b*c[10]+c[14],d*c[3]+0*c[7]+b*c[11]+c[15]]);a.b.uniformMatrix4fv(a.c,!1,d);a.a.push(d)}class y{constructor(a,d){this.b=a;this.c=d;this.a=[];a.uniformMatrix4fv(d,!1,w)}pop(){return this.a.pop()}}
class z{constructor(a,d){this.name=a.name;var b=this.b=a.b;a=this.type=a.type;switch(a){case "vertex":var c=this.b.VERTEX_SHADER;break;case "fragment":c=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}c=this.a=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))throw d=`Failed to compile ${this.name} ${a}-shader: ${b.getShaderInfoLog(c)}`,b.deleteShader(c),Error(d);this.A=v(d)}}
function A(a,...d){const b=a.b,c=a.m;d.forEach(e=>{a.s.push(e);b.attachShader(c,e.a)});return a}
class B{constructor(a){this.name=a.name;this.h=a.h;a=this.b=a.b;this.a=!1;this.m=a.createProgram();this.s=[];this.l={};this.f={};this.stack=null;this.i=[];this.c=()=>void C(this)}link(){if(this.a)return this;var a=this.b,d=this.m;a.linkProgram(d);if(!a.getProgramParameter(d,a.LINK_STATUS)){var b=`Failed to link ${this.name} program: ${a.getProgramInfoLog(d)}`;a.deleteProgram(d);throw Error(b);}this.a=!0;return this}}
function C(a){var d=a.b,b=a.m;d.useProgram(b);for(var c={},e={},l=a.s,k=0;k<l.length;k++)for(var q=l[k].A,m=0;m<q.length;m++){var h=q[m];1===h.type?h.j in c||(c[h.name]=d.getUniformLocation(b,h.j)):h.j in e||(e[h.name]=d.getAttribLocation(b,h.j))}a.l=c;a.f=e;if(a.h)if(a.h in a.l)a.stack=new y(d,a.l[a.h]);else throw Error(`No anchor point ${a.h} in ${this}`);try{var p=a.i;for(k=0;k<p.length;p++)p[k](d,a)}finally{a.l=void 0,a.f=void 0,a.stack=null,1===a.i.length?a.i=[]:a.i.pop()}}
function D(a){return(new Promise(d=>{const b=new Image;b.onload=()=>d(b);b.src=a.src})).then(d=>new E(d,a))}
class E{constructor(a,d){const b=this.b=d.b;this.name=d.name;d=this.a=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,null);this.w=a.naturalWidth}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}};class F{constructor(){this.v=null;this.g=60;this.a=this.c=0;this.u=()=>{{const d=this.a;var a=Date.now();const b=this.o;0!==b&&(this.c=1E3/(a-b)*.1+.9*this.c);this.o=a;try{const c=this.v;c()}finally{a=1E3/this.g-(Date.now()-a),this.a===d&&(this.a=setTimeout(this.u,Math.max(a,0)))}}};this.o=0}start(a=this.g){this.g=a;this.a||(this.o=0,this.c=a,this.a=setTimeout(this.u,0))}};class G{constructor(a,d){this.a=a;this.c=null;a=this.data={};const b=[];let c=0;for(const e in d){const l=d[e],k=[],q=l.length;if(0===q)throw Error("Sprite declared with 0 points");const m=l[0].length;if(0==m)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");for(let h=0;h<q;h++){const p=l[h];if(p.length!==m)throw Error("Sprite declared with inconsistent lengths of elements");k.push(c++);b.push.apply(b,p)}a[e]={D:this,name:e,B:k,C:m/5}}this.g=new Float32Array(b)}}
;window.onload=async function(){function a(g,n){g=n.stack;var f=p;g.b.uniformMatrix4fv(g.c,!1,f);g.a.push(f);x(n.stack,(m-16)/32,25-(h+16)/32);g=q;if(!g.data.hasOwnProperty("main"))throw Error('Can not render unknown "main"');{f=g.a.b;let r=g.c;null!=r?f.bindBuffer(f.ARRAY_BUFFER,r):(g.c=r=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,r),f.bufferData(f.ARRAY_BUFFER,g.g,f.STATIC_DRAW));f.activeTexture(f.TEXTURE0);g.a.bindTexture();f.uniform1i(n.l.texture,0);f.enableVertexAttribArray(n.f.texturePosition);
f.vertexAttribPointer(n.f.texturePosition,2,f.FLOAT,!1,20,12);f.enableVertexAttribArray(n.f.position);f.vertexAttribPointer(n.f.position,3,f.FLOAT,!1,20,0)}n=g.data.main;g=g.a.b;g.drawArrays(g.TRIANGLE_STRIP,n.B[0],n.C)}const d=document.getElementById("fps"),b=document.getElementById("canvas");var c=window.getComputedStyle(b),e=parseInt(c.getPropertyValue("width"),10);c=parseInt(c.getPropertyValue("height"),10);var l=window.devicePixelRatio||1;1!==l&&(b.width=l*e,b.height=l*c);e=b.getContext("webgl",
{antialias:!1});e.enable(e.DEPTH_TEST);c=new z({b:e,type:"vertex"},"\n    attribute vec3 a_position;\n    attribute vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    varying highp vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n\n        gl_Position = position / position.w;\n        v_texturePosition = a_texturePosition;\n    }\n");l=new z({b:e,type:"fragment"},"\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    varying highp vec2 v_texturePosition;\n\n    void main() {\n        vec4 color = texture2D(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        gl_FragColor = color;\n    }\n");
const k=new B({b:e,h:"projection"});A(k,c,l).link();e=await D({b:e,src:"assets/marblol2.PNG",name:"pretend wall"});const q=new G(e,{main:[[1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,1,0,1]]});let m=0,h=0;const p=new Float32Array([.05,0,0,0,0,0,0,0,0,.08,0,0,-1,-1,0,1]),t=new F;t.v=function(){d.innerHTML=`fps=${Math.round(t.c)}/${t.g}`;k.i.push(a);requestAnimationFrame(k.c)};t.start(60);b.onmousemove=g=>{m=g.offsetX;h=g.offsetY}};
